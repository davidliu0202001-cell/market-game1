<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ”¶éŠ€ç‹æŒ‘æˆ°è³½ - æˆ°ç¸¾åˆ†äº«ç‰ˆ</title>
    <style>
        :root {
            --primary: #2e7d32;
            --blue: #1976d2;
            --purple: #7b1fa2;
            --line-green: #06C755;
            --bg: #f4f7f6;
        }
        body {
            font-family: 'Segoe UI', 'PingFang TC', 'Microsoft JhengHei', sans-serif;
            background-color: var(--bg);
            display: flex;
            justify-content: center;
            padding: 10px;
            margin: 0;
        }
        .app-card {
            background: white;
            padding: 1.5rem;
            border-radius: 1.5rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            width: 100%;
            max-width: 450px;
            text-align: center;
            display: none;
            position: relative;
        }
        /* ç™»å…¥ä»‹é¢ */
        #login-screen {
            background: white;
            padding: 2.5rem 1.5rem;
            border-radius: 1.5rem;
            width: 90%;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .social-btn {
            width: 100%;
            padding: 12px;
            margin-bottom: 10px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .google { background: #fff; border: 1px solid #ddd; color: #555; }
        .fb { background: #1877F2; color: white; }
        
        /* æ’è¡Œæ¦œ */
        .leaderboard {
            background: #fdf2f2;
            border: 1px solid #ffcdd2;
            border-radius: 10px;
            padding: 10px;
            margin-top: 15px;
            text-align: left;
        }
        .leaderboard-title { font-weight: bold; color: #d32f2f; margin-bottom: 5px; }

        /* éŠæˆ²æ ¸å¿ƒæ¨£å¼ */
        .display-area { background: #f9fbe7; border: 2px dashed var(--primary); border-radius: 1rem; padding: 1rem; margin: 1rem 0; text-align: left; }
        .item-row { display: flex; justify-content: space-between; font-size: 1.2rem; margin-bottom: 5px; }
        .highlight-box { background: #fff8e1; padding: 15px; border-radius: 10px; font-size: 1.4rem; font-weight: bold; margin-bottom: 15px; border: 1px solid #ffe082; }
        input[type="number"] { width: 80%; padding: 12px; font-size: 2rem; border: 2px solid #ddd; border-radius: 10px; margin-bottom: 10px; text-align: center; }
        
        .btn { width: 100%; padding: 1rem; font-size: 1.2rem; border-radius: 10px; border: none; cursor: pointer; font-weight: bold; color: white; margin-top: 5px; }
        .btn-check { background: var(--primary); }
        .btn-next { background: var(--blue); display: none; }
        
        /* åˆ†äº«æŒ‰éˆ•æ¨£å¼ */
        .btn-share {
            background: var(--line-green);
            display: none; /* é è¨­éš±è—ï¼Œç­”å°å¾Œé¡¯ç¤º */
            margin-top: 10px;
        }

        .sound-toggle { position: absolute; top: 15px; right: 15px; font-size: 1.5rem; border: none; background: none; cursor: pointer; }
        .history-info { font-size: 1rem; color: #2e7d32; background: #e8f5e9; padding: 8px; border-radius: 5px; margin-bottom: 10px; font-weight: bold; text-align: left; }
    </style>
</head>
<body>

<div id="login-screen">
    <h1 style="color: var(--primary); margin-bottom: 10px;">ğŸ® æ”¶éŠ€ç‹æŒ‘æˆ°è³½</h1>
    <p style="color: #666;">è¼¸å…¥åç¨±é–‹å§‹ç·´ç¿’ï¼š</p>
    <input type="text" id="userNameInput" style="width: 80%; padding: 12px; font-size: 1.2rem; margin-bottom: 25px; border: 2px solid #ddd; border-radius: 8px;" placeholder="åª½åª½">
    
    <button class="social-btn google" onclick="fakeLogin()">
        <img src="https://www.google.com/favicon.ico" width="18"> Google ç™»å…¥æŒ‘æˆ°
    </button>
    <button class="social-btn fb" onclick="fakeLogin()">
        <span style="font-size: 1.2rem; font-family: sans-serif;">f</span> Facebook ç™»å…¥æŒ‘æˆ°
    </button>
</div>

<div class="app-card" id="game-screen">
    <button class="sound-toggle" onclick="toggleMute()" id="muteBtn">ğŸ”Š</button>
    <div style="font-weight: bold; color: #666; margin-bottom: 8px;">æŒ‘æˆ°è€…ï¼š<span id="displayName"></span></div>

    <div class="stats-bar" style="display:flex; justify-content:space-around; background:#eee; padding:10px; border-radius:10px; margin-bottom:15px;">
        <span>ğŸ† ç©åˆ†: <span id="score">0</span></span>
        <span>ğŸ”¥ é€£å‹: <span id="combo">0</span></span>
        <span>â³ <span id="seconds">0</span>s</span>
    </div>

    <div class="display-area" id="displayArea"></div>
    <div id="historyContainer"></div>
    <div class="highlight-box" id="promptText"></div>

    <input type="number" id="ansInput" placeholder="?" autocomplete="off" inputmode="numeric">
    <div id="msg" style="margin: 10px 0; font-weight: bold; min-height: 1.5rem;"></div>
    
    <button class="btn btn-check" id="checkBtn" onclick="verify()">é€å‡ºç­”æ¡ˆ</button>
    <button class="btn btn-next" id="nextBtn" onclick="initGame()">ä¸‹ä¸€é¡Œ âœ</button>
    
    <button class="btn btn-share" id="shareBtn" onclick="shareToLine()">
        ğŸ“¢ åˆ†äº«æˆ°ç¸¾çµ¦è¦ªæˆš
    </button>

    <div class="leaderboard">
        <div class="leaderboard-title">ğŸš© æœ¬æ©Ÿæœ€é«˜æ¦®è­½</div>
        <div id="leaderList" style="font-size: 0.9rem;">å°šç„¡ç´€éŒ„</div>
    </div>
</div>

<audio id="sndCorrect" src="https://assets.mixkit.co/active_storage/sfx/2013/2013-preview.mp3"></audio>
<audio id="sndWrong" src="https://assets.mixkit.co/active_storage/sfx/2018/2018-preview.mp3"></audio>

<script>
    let user = "";
    let score = 0, combo = 0, seconds = 0, targetAnswer = 0, timerInterval;
    let mixedStep = 1, mixedTotal = 0, mixedPaid = 0, isMuted = false;

    function fakeLogin() {
        user = document.getElementById('userNameInput').value.trim() || "åª½åª½";
        document.getElementById('login-screen').style.display = 'none';
        document.getElementById('game-screen').style.display = 'block';
        document.getElementById('displayName').innerText = user;
        updateLeaderboard();
        initGame();
    }

    function toggleMute() {
        isMuted = !isMuted;
        document.getElementById('muteBtn').innerText = isMuted ? "ğŸ”‡" : "ğŸ”Š";
    }

    const products = [
        { n: "ç‰›è‚‰éºµ", e: "ğŸœ", p: 130 }, { n: "ç‚¸é†¬éºµ", e: "ğŸ", p: 100 },
        { n: "ç‡™é’èœ", e: "ğŸ¥¬", p: 40 }, { n: "æ»·å‘³", e: "ğŸ¢", p: 65 },
        { n: "é®®ä¹³", e: "ğŸ¥›", p: 90 }, { n: "é›æ’", e: "ğŸ—", p: 85 }
    ];

    function initGame() {
        clearInterval(timerInterval); seconds = 0; mixedStep = 1;
        document.getElementById('msg').innerText = '';
        document.getElementById('ansInput').value = '';
        document.getElementById('ansInput').disabled = false;
        document.getElementById('checkBtn').style.display = 'block';
        document.getElementById('nextBtn').style.display = 'none';
        document.getElementById('shareBtn').style.display = 'none'; // æ–°é¡Œç›®éš±è—åˆ†äº«
        document.getElementById('historyContainer').innerHTML = '';

        const item = products[Math.floor(Math.random()*products.length)];
        const qty = Math.floor(Math.random()*2) + 1;
        mixedTotal = item.p * qty;
        mixedPaid = mixedTotal > 500 ? 1000 : 500;
        
        document.getElementById('displayArea').innerHTML = `<div class="item-row"><span>${item.e} ${item.n} ($${item.p})</span><span>x ${qty}</span></div>`;
        document.getElementById('promptText').innerHTML = `è«‹ç®—å‡ºç¸½åƒ¹ï¼š`;
        targetAnswer = mixedTotal;

        timerInterval = setInterval(() => { seconds++; document.getElementById('seconds').innerText = seconds; }, 1000);
        document.getElementById('ansInput').focus();
    }

    function verify() {
        const val = parseInt(document.getElementById('ansInput').value);
        if(isNaN(val)) return;

        if (mixedStep === 1) {
            if (val === targetAnswer) {
                if(!isMuted) document.getElementById('sndCorrect').play();
                mixedStep = 2;
                document.getElementById('historyContainer').innerHTML = `<div class="history-info">âœ… ç¸½åƒ¹ç¢ºèªï¼š$${mixedTotal}</div>`;
                document.getElementById('ansInput').value = '';
                document.getElementById('promptText').innerHTML = `é¡§å®¢ä»˜äº† ${mixedPaid}ï¼Œè¦æ‰¾å¤šå°‘ï¼Ÿ`;
                targetAnswer = mixedPaid - mixedTotal;
                document.getElementById('ansInput').focus();
            } else { fail(); }
        } else {
            if(val === targetAnswer) success(); else fail();
        }
    }

    function success() {
        if(!isMuted) document.getElementById('sndCorrect').play();
        score++; combo++;
        document.getElementById('msg').style.color = "green";
        document.getElementById('msg').innerText = "âœ… å¤ªæ£’äº†ï¼ç®—å°äº†ï¼";
        saveRecord(score);
        finishRound();
    }

    function fail() {
        if(!isMuted) document.getElementById('sndWrong').play();
        combo = 0;
        document.getElementById('msg').style.color = "red";
        document.getElementById('msg').innerText = `âŒ ä¸å°å–”ï¼Œæ­£ç¢ºç­”æ¡ˆæ˜¯ ${targetAnswer}`;
        finishRound();
    }

    function finishRound() {
        clearInterval(timerInterval);
        document.getElementById('score').innerText = score;
        document.getElementById('combo').innerText = combo;
        document.getElementById('ansInput').disabled = true;
        document.getElementById('checkBtn').style.display = 'none';
        document.getElementById('nextBtn').style.display = 'block';
        document.getElementById('shareBtn').style.display = 'block'; // é¡¯ç¤ºåˆ†äº«æŒ‰éˆ•
    }

    function saveRecord(s) {
        let history = JSON.parse(localStorage.getItem('cashierRecords') || "[]");
        history.push({ name: user, score: s, date: new Date().toLocaleDateString() });
        history.sort((a, b) => b.score - a.score);
        localStorage.setItem('cashierRecords', JSON.stringify(history.slice(0, 5)));
        updateLeaderboard();
    }

    function updateLeaderboard() {
        const history = JSON.parse(localStorage.getItem('cashierRecords') || "[]");
        const list = document.getElementById('leaderList');
        if(history.length === 0) return;
        list.innerHTML = history.map((r, i) => `<div>#${i+1} ${r.name} - ${r.score}é¡Œ</div>`).join('');
    }

    // åˆ†äº«åˆ° LINE çš„åŠŸèƒ½
    function shareToLine() {
        const url = window.location.href;
        const text = `æˆ‘æ˜¯æ”¶éŠ€ç‹ ${user}ï¼æˆ‘å‰›æ‰é€£çºŒç­”å°äº† ${score} é¡Œï¼ğŸ”¥ ä½ æ•¢ä¾†æŒ‘æˆ°æˆ‘å—ï¼Ÿç·´ç¿’æ‰¾éŒ¢é€£çµï¼š${url}`;
        const lineUrl = `https://line.me/R/msg/text/?${encodeURIComponent(text)}`;
        window.open(lineUrl, '_blank');
    }
</script>
</body>
</html>
